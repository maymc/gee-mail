<!DOCTYPE html>
<html>
	<head>
		<script src="js/mail-generator.js"></script>
		<link href="css/style.css" rel="stylesheet" media="screen">

	    <script>
	      window.onload = function(){
	        // ALL OF YOUR JAVASCRIPT CODE SHOULD GO HERE. 
	        // We have to use window.onload so your JavaScript doesn't execute until the page has loaded and all HTML has been downloaded to your browser
	        
	        //Geemails array is populated already after this code runs
	        console.log(geemails);

	        //Obtain parent of messages
	        var inboxElem = document.getElementById("inboxTable");

	        for(var i=0; i<geemails.length; i++){

	        	//Create a new row for the new message
		        var msgElem = document.createElement("tr");
		        msgElem.className = "message";
		        inboxElem.appendChild(msgElem);

		        //Populate new msg with new date
		        var dateElem = document.createElement("td");
		        dateElem.id = "date";
		        dateElem.innerHTML = geemails[i].date;
		        msgElem.appendChild(dateElem);

		        //Populate new msg with new sender
		        var senderElem = document.createElement("td");
		        senderElem.id = "sender";
		        senderElem.innerHTML = geemails[i].sender;
		        msgElem.appendChild(senderElem);

		        //Populate new msg with new subject
		       	var subjectElem = document.createElement("td");
		        subjectElem.id = "subject";
		        subjectElem.innerHTML = geemails[i].subject;
		        msgElem.appendChild(subjectElem);

		        //Populate new msg with new body
		        var bodyElem = document.createElement("td");
		        bodyElem.id = "body";
		        bodyElem.innerHTML = geemails[i].body;
		        msgElem.appendChild(bodyElem);
		        bodyElem.style.display = "none";

	        }

	        //Get message element, clicking anywhere on the message will show the body
			var msgClick = document.getElementsByClassName("message");

			//Add event listeners to each msg
			for(var j=0; j<msgClick.length; j++){
				msgClick[j].addEventListener("click", toggle);
			}

			//Function to Show/Hide the msg body
			function toggle(){
				var clicked = this.querySelectorAll("#body")[0];
				if(clicked.style.display === "none")
					clicked.style.display = "block";
				else
					clicked.style.display = "none";
			}

			//Inbox count to show current number of messages in the inbox
			var count = document.getElementById("inboxCount");
	        count.innerHTML = "Number of messages: " + geemails.length;

	        //Using setInterval to create a recurring function to generate new messages
	        var recurringMsgs = setInterval(newMsg, 3000);

	        //A function that calls the existing "getNewMessage" function that returns a newly created message with the same properties as previous messages

	        function newMsg(){

	        	//Invoke the function to get a new message
				var newMsg = getNewMessage();

				//Push the new message into the geemail array
				geemails.push(newMsg);
				var count2 = geemails.length;
				console.log("new msg length: "+ count2);

				//Insert the new message as a new row at the bottom of the table
				var addedRow = inboxElem.insertRow(-1);

				//Populate the added row's date
				var dateElem2 = addedRow.insertCell(0);
				dateElem2.innerHTML = geemails[count2-1].date;

				//Populate the added row's sender
				var senderElem2 = addedRow.insertCell(1);
				senderElem2.innerHTML = geemails[count2-1].sender;

				//Populate the added row's subject
				var subjectElem2 = addedRow.insertCell(2);
				subjectElem2.innerHTML = geemails[count2-1].subject;

				//Populate the added row's body
				var bodyElem2 = addedRow.insertCell(3);
				bodyElem2.id = "body";
				bodyElem2.innerHTML = geemails[count2-1].body;
				bodyElem2.style.display = "none";

				//Make the message clickable to toggle
				addedRow.addEventListener("click", toggle);

				//Update the inbox message count
				count.innerHTML = "Number of messages: " + geemails.length;
			}

			//Function to stop the recurring getNewMessage function
			function stopNewMsgs() {
   				clearInterval(recurringMsgs);
			}

			//Create a stop button to stop the recurring getNewMessage function
			var stopElem = document.getElementById("stopBtn");
			stopElem.innerHTML = "Stop Messages";
			stopElem.addEventListener("click", stopNewMsgs);

	    };



	    </script>

	</head>
	

	<body>
		<header>
			<div>
				<h1 id="appName">Gee-Mail</h1>
			</div>
		</header>

		<!--Show an inbox count to show the current number of messages in your inbox-->
		<div id="inboxCount"></div>

		<button id="stopBtn"></button>

		<section class="content">
			<table id=inboxTable></table>
		</section>






	</body>
</html>






